<% nodes.each do |node| %>
  <%# Single answer set %>
  <% if node.set %>

    <%= render("responses/answers/set", set: node.set, inst_num: inst_num) %>

  <%# Group with one or more instances %>
  <% else %>

    <div class="qing-group" id="group-<%= node.item.id %>" data-group-id="<%= node.item.id %>">

      <div class="qing-group-instances">
        <% node.instances.each do |instance| %>
          <%= render("responses/answers/instance", node: node, instance: instance) %>
        <% end %>
      </div>

      <% if node.repeats? && !read_only %>
        <a href="#" class="add-instance"><%= "#{t("common.add")} #{node.item.group_name}" %></a>
      <% end %>

      <% if node.repeats? && !read_only %>
        <%= javascript_doc_ready do %>
          new ELMO.Views.RepeatGroupFormView({
            el: <%=json "#group-#{node.item.id}" %>,
            tmpl: <%=json render("responses/answers/instance", node: node, instance: node.blank_instance) %>
          })
        <% end %>
      <% end %>
    </div>

  <% end %>
<% end %>
