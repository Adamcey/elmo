<div class="option_set_form">

  <%# need to print this here if in ajax mode %>
  <%= render("layouts/flash", :flash => flash) if request.xhr? %>

  <%= render('top_action_links') %>

  <% if form_mode == :edit %>
    <%= render('warnings') %>
  <% end %>

  <%= elmo_form_for(@option_set, :url => form_mode == :import ? import_option_sets_path : nil) do |f| %>
    <%= f.field(:name, :required => true, :read_only => cannot?(:update_core, @option_set)) %>
    <% if form_mode == :import %>
      <%= f.field(:file, :type => :file, :required => true, :read_only => cannot?(:import, @option_set)) %>
    <% else %>
      <%= f.field(:geographic, :type => :check_box, :read_only => cannot?(:change_geographic, @option_set)) %>
      <%= f.field(:allow_coordinates, :type => :check_box, :read_only => cannot?(:change_geographic, @option_set)) %>
      <%= f.field(:multi_level, :type => :check_box,
        :read_only => cannot?(:update_core, @option_set) || @option_set.has_select_multiple_questions? || @option_set.huge?) %>
      <%= f.field(:option_levels, :partial => "option_levels") %>
      <%= f.field(:options, :required => true, :partial => "options") %>
    <% end %>
    <div class="submit-buttons">
      <%= loading_indicator %>&nbsp;
      <%= f.submit(form_mode == :import ? :import : :save, :class => "btn btn-primary") unless params[:modal_mode] %>
    </div>
  <% end %>
</div>

<% unless form_mode == :import %>
<%= javascript_doc_ready do %>
  new ELMO.Views.OptionSetForm(<%=json(
    option_set: @option_set.as_json(:for_option_set_form => true),

    edit_link: action_link(:edit, '#'),
    remove_link: action_link(:remove, '#'),
    suggest_path: suggest_options_path,

    # Options and option levels are not editable if Option Set is huge.
    options_levels_read_only: read_only || @option_set.huge?,

    # Whether the form is being loaded in a modal.
    modal_mode: params[:modal_mode].present?,

    can_reorder: can?(:reorder_options, @option_set),
    can_remove_options: can?(:remove_options, @option_set),
    max_option_name_length: Option::MAX_NAME_LENGTH
  )%>);
<% end %>
<% end %>
