<h:html xmlns="http://www.w3.org/2002/xforms" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:h="http://www.w3.org/1999/xhtml" xmlns:jr="http://openrosa.org/javarosa" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
  <h:head>
    <h:title><%= @form.full_name %></h:title>
    <model>
      <instance>
        <%# include both form ID and form version sequence number in ODK form ID %>
        <data id="<%= @form.id %>" version="<%= @form.current_version.sequence %>">
          <% @form.visible_questionings.each do |q| %>
            <%= tag(q.question.odk_code) %>
          <% end %>
        </data>
      </instance>
      <itext>
        <% configatron.preferred_locales.each do |lang| %>
          <translation lang="<%= language_name(lang) %>">
            <% @form.visible_questionings.each do |q| %>
              <text id="<%= q.question.odk_code %>:label">
                <value><%= q.question.name(lang, :strict => false) %></value>
              </text>
              <text id="<%= q.question.odk_code %>:hint">
                <value><%= q.question.hint(lang, :strict => false) %></value>
              </text>
            <% end %>
            <% @form.option_sets.collect{|set| set.options}.flatten.uniq{|o| o.id}.each do |opt| %>
              <text id="option<%= opt.id %>">
                <value><%= opt.name(lang, :strict => false) %></value>
              </text>
            <% end %>
            <%= incomplete_response_translations if @form.allow_incomplete? %>
          </translation>
        <% end %>
      </itext>
      <% @form.visible_questionings.each do |q| %>
        <%= generate_bind_xml(@form, q) %>
      <% end %>
      <% if @form.allow_incomplete? %>
        <%= incomplete_response_binding(@form) %>
      <% end %>
    </model>
  </h:head>
  <h:body>
    <% @form.visible_questionings.each do |q| %>
      <% next if q.question.qtype.odk_tag.nil? %>
      <%= odk_input_tag(q) do %>
        <label ref="jr:itext('<%= q.question.odk_code %>:label')"/>
        <hint ref="jr:itext('<%= q.question.odk_code %>:hint')"/>
        <% if set = q.question.option_set %>
          <% set.options.each do |opt| %>
            <item>
              <label ref="jr:itext('option<%= opt.id %>')"/>
              <value><%= opt.id %></value>
            </item>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
    <% if @form.allow_incomplete? %>
      <select1 ref="/data/<%= OdkHelper::IR_QUESTION %>">
        <label ref="jr:itext('<%= OdkHelper::IR_QUESTION %>:label')"/>
        <item>
          <label ref="jr:itext('option1')"/>
          <value>1</value>
        </item>
        <item>
          <label ref="jr:itext('option2')"/>
          <value>2</value>
        </item>
      </select1>
      <input ref="/data/<%= OdkHelper::IR_CODE %>">
        <label ref="jr:itext('<%= OdkHelper::IR_CODE %>:label')"/>
        <hint ref="jr:itext('<%= OdkHelper::IR_CODE %>:hint')"/>
      </input>
    <% end %>
  </h:body>
</h:html>
